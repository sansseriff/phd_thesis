## System
<!-- %## Quick layout explanation -->
<span class="html">Figure [introduction:1](./section_03_introduction.md#fig:system)</span> <span class="latex">@fig:system</span> shows the experimental setup. Pulses from the 4.09 GHz mode-locked laser, with a center wavelength at 1539.47 nm, are sent through an 80 ps delay-line interferometer (Optoplex). This generates the pulses used to encode early/late basis states ($|e\rangle,|l\rangle$), which are subsequently up-converted by a second harmonic generation (SHG) module (Pritel) and down-converted into entangled photon pairs by a type-0 spontaneous parametric down conversion (SPDC) crystal (Covesion)~[@Marcikic2002]. The up-converted pulses at 769 nm have a FWHM bandwidth of 243 GHz (0.48 nm), which along with the phase matching condition of the SPDC waveguide, defines a wide joint spectral intensity (JSI) function~[@kim2005measurement]. 

<!-- %## Finish quicky layout explanation -->
The photon pairs, which are separated by a coarse wavelength division multiplexer (CWDM), are of the form $|\psi\rangle=\frac{1}{\sqrt{2}}\left(|e\rangle_{s}|e\rangle_{i}+e^{i \phi}|l\rangle_{s}|l\rangle_{i}\right)$. Entangled idler and signal photons are sent to the receiving stations labeled Alice and Bob, respectively. One readout interferometer at each station projects all spectral bands into a composite time-phase basis. From here, dense wavelength division multiplexers (DWDM) divide up the energy-time entangled photon pairs into spectral channels. 

<!-- %## detectors -->
DWDM outputs are sent to differential niobium nitride (NbN) single pixel SNSPDs~[@Colangelo2023] with 22 × 15~µm active areas formed by meanders of 100-nm-wide and 5-nm-thick niobium nitride (NbN) nanowires on a 500~nm pitch. These measure the arrival time of photons with respect to a clock signal derived from the mode locked laser. Use of the high system repetition rate and compact 80~ps delay interferometers is only possible due to the high timing resolution of these detectors. Low jitter performance is achieved by incorporating impedance matching tapers for efficient RF coupling, resulting in higher slew rate pulses, and by enabling RF pulse readout from both ends of the nanowire. The dual-ended readout allows for the cancellation of jitter caused by the variable location of photon arrival along the meander when the differential signals are recombined with a balun. We use two SNSPDs for this demonstration with efficiencies at 1550~nm of 66\% and 74\%. A full 8-channel implementation of this system would require 16 detectors operating in parallel at both Alice and Bob. To read out both outputs of both interferometers, 4 detectors per channel are required, resulting in 32 detectors total. 

<!-- % time walk correction -->
A novel time-walk or pulse-pileup correction technique is used to extract accurate measurements of SNSPD pulses that arrive between 23 and 200~ns after a previous detection on the same RF channel. Without special handling of these events, timing jitter will suffer due to RF pulse amplitude variations and pileup effects. As detailed in <span class="html">[the time walk correction section](./section_07_experiment_details.md#time-walk-correction)</span><span class="latex">section \ref{time-walk-correction}</span>, the correction method works by subtracting off predicable timing distortions based on the inter-arrival time that precedes them~[@Mueller2023; @Craiciu23]. An in-situ calibration process is used to build a lookup table that relates corrections and inter-arrival time. At the highest achievable pump power, this correction method leads to 320\% higher coincidence rates compared to a data filtering method that rejects all distorted events arriving within $\simeq$ 200~ns of a previous pulse. 

## Results

<!-- %## Intro to channel_jsi -->
By pairing up particular 100~GHz DWDM channels and recording coincidence rates, a discretized form of the JSI of our pair source is measured (@fig:figure_2nd_1 a). Due to the wide pump bandwidth, the spectrum of signal photons spans several ITU channels for a given idler photon wavelength. Pairs along the main diagonal are optimized for maximum coincidence rates by tuning the pump laser frequency, and are therefore used for all remaining measurements. In <span class="html">[(b) of the system figure](./section_03_introduction.md#fig:system)</span><span class="latex">@fig:system b</span>, these pairs are highlighted with matching colors. Coupling efficiencies $\eta$ shown in @fig:figure_2nd_1 a are derived from <span class="html">[a JSI fitting analysis](./section_06_modelling_details.md#joint-spectral-intensity-analysis)</span><span class="latex">a JSI fitting analysis in \ref{joint-spectral-intensity-analysis}</span> and include all losses between the generation of entangled pairs in the SPDC and final photo-detection.


A joint spectral analysis of the 100~GHz fiters applied to the wide-bandwidth pumped JSI shows only a fraction of idler (signal) photons that pass though one filter will be detected with their corresponding signal (idler) photon. This is true even for ideal filters that are 100\% transmissive within their passbands, which demonstrates a geometrical limit on the ratio of coincidence rates to singles rates in this regime of large bandwidth JSI and narrowband filters. For calculations of $\mu$ in terms of coincidence rate $C_{AB}$, repetition rate $R$, and singles rates $S_A, S_B$, we account for this by adding a geometric compensation factor $\delta$ to the commonly used equation:

$$
\begin{align}
\mu =  \frac{\delta S_A S_B}{R C_{AB}}.
\end{align}
$$

This gives a definition of $\mu$ for the JSI region where signal and idler filters overlap according to energy conservation, and the probability of transmitting entangled pairs to both Alice and Bob is non-negligible. It is valid in the low $\mu$ regime where generation of higher order photon number states from the SPDC are rare. For filter pairings along the main diagonal in @fig:figure_2nd_1 a, values for $\delta$ are fairly consistent and average to $\delta = 0.393 \pm 0.012$. The derivation of $\delta$ is detailed in <span class='html'>[the $\mu$ estimate section](./section_06_modelling_details.md#consequences-of-narroband-filtering)</span><span class='latex'>section \ref{consequences-of-narroband-filtering}</span>. 


![**Joint spectral intensity measurements and histogram** a) The singles rates at Alice $S_A$ and Bob $S_B$ (grey bars), path coupling efficiencies (purple bars), and coincidence rates $C_{AB}$ (black text in colored boxes) for different DWDM channel pairings. All measurements are recorded at a SHG pump power of 14.6~mW, for which $\mu$ of the channel pairs along the main diagonal are shown in red text. The joint spectral intensity envelop spans several 100 GHz channels. As detailed in <span class="html">[the coincidence rate section](./section_06_modelling_details.md#coincidence-rate-interferometer-output-ports)</span><span class="latex">section \ref{coincidence-rate-interferometer-output-ports}</span>, the coincidence rates (kHz, black) are scaled to represent two branches of the total wavefunction, so that they are consistent with the coupling efficiencies $\eta$ (purple bars) and the singles rates (grey bars). There are four branches for each pairing of the four interferometer output ports. In practice, one output each of Alice and Bob's interferometers is measured, thereby capturing one branch. See <span class="html">[the JSI modelling section](./section_06_modelling_details.md#jsi-modelling) section</span><span class="latex">section \ref{jsi-modelling}</span> for details on the fitting method used to solve for the coupling efficiencies $\eta$. b) Coincidence rates for energy-matched channel pairings. The light green bars depict the main diagonal in (a). Grey bars are measured with x16 DWDM at Alice and a tunable narrowband filter at Bob. Dashed bars predict the rates for a system with x16 DWDMs at both Alice and Bob c) Histogram of photon arrival events with respect to the 4.09 GHz clock. Dashed black and grey lines show the response functions for coincidence events. Red bars represent guard regions where coincidence events are ignored. Events within 10~ps guard regions centered at 80 and 160~ps (shaded red) are discarded for analysis of coincidences between individual bins. This is done to maximize visibility in the presence of some minor overlap of the pulses (see <span class='html'>[the guard region section](./section_07_experiment_details.md#guard-regions)</span><span class='latex'>section \ref{guard-regions}</span> for details).](./figs/jsi_figure_light.svg){#fig:figure_2nd_1 short-caption='Joint spectral intensity measurements and histogram' width=100% path="chapter_05"}



<!-- %## efficiency -->
<!-- % Figure \ref{fig:figure_2nd_1}a also shows coupling efficiencies $\eta$ for each DWDM channel, $S_A$ is the singles rate at Alice, and $S_B$ is the singles rate at Bob \cite{Neumann2022Entanglement}.   -->

<!-- % As only two of the total four interferometer output ports are measured at once, certain scalings are made to the singles and coincidence rates $C_{AB}$ to reflect a readout configuration with well defined coupling efficiency (see supplementary information). 
% We define the diagonal of \ref{fig:figure_2nd_1}a as the 'working' channel pairings for all further analysis. Fig. \ref{fig:figure_2nd_1}b includes these pairings and measurements gathered with a 16-channel DWDM at Alice and a narrowband filter at Bob.  -->


<!-- %## 16 channel diagonal -->
In the following, rigorous tests of entanglement are primarily done with the 8 ITU 100 GHz channel pairings: Ch. 35-42 at Alice and Ch. 52-49 at Bob. However, in @fig:figure_2nd_1 b we investigate rates across 16 pairs by using all 16 channels available on the DWDM at Alice (24 — 34) and a tunable narrowband filter in place of the DWDM at Bob. As the narrowband filter has higher loss and 45~GHz FWHM passband (see <span class="html">[the filter bandwidths section](./section_07_experiment_details.md#filter-bandwidths)</span><span class="latex">section \ref{filter-bandwidths}</span> for measurements), the coincidence rates are lower (grey bars in @fig:figure_2nd_1 b). But the uniformity of coincidence rates across 16 channels implies that the use of 16-channel DWDMs at both Alice and Bob would roughly double the total coincidence rate. 


<!-- %## intro figure 2c -->
Signals from the SNSPDs are directed to a free-running time tagger (Swabian) and processed with custom software. The resulting histograms, referenced from a shared clock (@fig:figure_2nd_1 c), depict three peaks, which are caused by the sequential delays of the source and readout interferometers. Some intensity imbalance between long and short paths is present in these interferometers, which explains the asymmetry between early and late peaks in @fig:figure_2nd_1 c. Such imbalances are present in both the source and readout interferometers to varying degrees. The interferometer used for the source exhibits an early/late intensity balance ratio of 1.13. Alice and Bob's interferometers exhibit early/late imbalances of 1.24 and 1.15, respectively. An analysis of how this type of imbalance affects entanglement visibility is included in <span class="html"> [the interferometer imbalance section](../removed_chapter_09/index.md)</span><span class="latex"> the interferometer imbalance section, available in the supplemental of the \href{https://arxiv.org/abs/2310.01804}{published manuscript}</span>. 

<!-- %# about phase variation and guard regions -->
<!-- #### Phase variation and guard regions -->
The coincidence rate across Alice and Bob's middle bins varies sinusoidally with respect to the combined phase relationship of the source and readout interferometers (see <span class="html">the [tomography section](./section_06_modelling_details.md#quantum-state-tomography) section<span><span class="latex">section \ref{quantum-state-tomography}<span>.)~[@Inagaki2013; @Marcikic2002]. In @fig:figure_2nd_1 c  the coincidences shown are for any combination of early, middle, or late bins. For tomography and visibility measurements, coincidence detections across specific bin pairings are considered.  

![**Entanglement visibility and rates vs pump power** a) Visibility versus pump power. Error bars are calculated by taking multiple measurements of the center bin coincidence rate over some integration time. These measurements span small ranges of interferometer phase, as the extremum-finding algorithm jitters the interferometer voltage. b) Bounded distillable entanglement rate versus pump power. Multiple such measurements are made for all the tomographic measurements. These are used to calculate standard deviations for visibility, log negativity, and coherent information. Error bars for the log negativity and coherent information are smaller than the line width shown. Rates shown assume readout of all 4 available interferometer ports, based on data measured using one port each at Alice and Bob.](./figs/shg_scan_light.svg){#fig:shg_scan short-caption='Entanglement visibility and rates vs pump power' width=80% path="chapter_05"}

Due to the small size and temperature insensitivity of the interferometers, minimal temporal phase drift is observed over multiple hours. Nevertheless, software is used to lock the phase at a minimum or maximum with a simple hill-climbing algorithm. This varies the phase by small amounts over several minutes to search for or maintain an extremum. 

<!-- %## Figure 3 and visibility definition -->
Channels 35 and 59 are chosen for an analysis of entanglement visibility and rates versus pump power. Visibility with respect to pump power or mean entangled pair rate is shown in @fig:shg_scan a. We define the entanglement visibility as $V = 100\%*(C_{max} - C_{min})/(C_{max} + C_{min})$ where $C_{min}$ and $C_{max}$ are the minimum and maximum coincidence rates in the middle bin for varied phase. As this coincidence rate depends on the total phase across the source and readout interferometers, only Bob's interferometer is actively controlled to scan the full state space. 

The raw visibility versus $\mu$ is shown in blue in @fig:shg_scan a. Relative to similar measurements [@Kim2022], this drops quickly with increasing $\mu$, and one reason is the presence of accidental coincidences across mutually incompatible spectral modes. The presence of these unwanted coincidences is a consequence of the narrowband filtering regime, and depends on factors included the singles rates $S_A$ and $S_B$, and the geometric compensation factor $\delta$ (see <span class='html'>[the incompatible bases section](./section_07_experiment_details.md#incompatible-bases-accidental-coincidence-rate)</span><span class='latex'>section \ref{incompatible-bases-accidental-coincidence-rate}</span> for derivation). We model this type of accidental coincidence rate $C_{Acc}$ versus $\mu$, and subtract it off from coincidence measurements to produce the grey data in @fig:shg_scan a. This simulated visibility's more gradual drop with increasing $\mu$ highlights the detrimental effect of our high single-to-coincidence rates $S_A/C_{AB}$, $S_B/C_{AB}$. As detailed in the discussion section below, this motivates special source engineering techniques for future systems. 

<!-- \begin{figure}
    \centering
    \includegraphics[width=0.8\linewidth]{8ch_bar_graph_high_power_light.pdf}
    \caption{a) Visibility for the main 8 channel pairs, measured at a high (22.9~mW) and a low (0.21~mW) SHG pump power setting. Each power setting results in similar $\mu$ for all channels: $\mu_L = 5.6{\times}10^{-5} \pm 9{\times}10^{-6}$ and $\mu_H = 5.0{\times}10^{-3} \pm 3{\times}10^{-4}$.  b) Rate metrics for the 8 channel pairs at the same high and low power settings. The range of possible values for distillable entanglement rate is spanned by the yellow regions, bounded above by log-negativity and below by coherent information. Rates shown assume readout of all 4 available interferometer ports, based on data measured using one port each at Alice and Bob}
    \label{fig:channel_data}
\end{figure} -->

![**Visibilities and rates for 8 channel pairs** a) Visibility for the main 8 channel pairs, measured at a high (22.9~mW) and a low (0.21~mW) SHG pump power setting. Each power setting results in similar $\mu$ for all channels: $\mu_L = 5.6{\times}10^{-5} \pm 9{\times}10^{-6}$ and $\mu_H = 5.0{\times}10^{-3} \pm 3{\times}10^{-4}$.  b) Rate metrics for the 8 channel pairs at the same high and low power settings. The range of possible values for distillable entanglement rate is spanned by the yellow regions, bounded above by log-negativity and below by coherent information. Rates shown assume readout of all 4 available interferometer ports, based on data measured using one port each at Alice and Bob](./figs/8ch_bar_graph_high_power_light.svg){#fig:channel_data short-caption='Visibilities and rates for 8 channel pairs' width=80% path="chapter_05"}

We quantify the rate of useful entanglement by supplying bounds for the distillable entanglement rate $C_D$. Measured in ebits/s, $C_D$ is the maximal asymptotic rate of Bell-pair production per coincidence using only local operations and classical communications [@Alshowkan2022; @Bennett1996]. It is bounded above by log-negativity $C_N = C_{AB} E_N$ and below by coherent information $C_I = C_{AB} E_I$ [@Alshowkan2022]. For each pump power setting in @fig:shg_scan, a series of tomographic measurements is performed and density matrices are calculated. The values of $E_I$ and $E_N$ are calculated from the density matrices as detailed in <span class='html'>the [tomography section](./section_06_modelling_details.md#quantum-state-tomography)</span><span class='latex'>section \ref{quantum-state-tomography}</span>. 

@fig:channel_data shows visibilities, raw coincidence rates, and bounded distillable entanglement rates for two pump powers and all 8 channel pairings. The highest pump power is currently limited by our EDFA-amplified SHG module. The pump power in principle could be increased until the SNSPD efficiency drops due to saturation, and the net coincidence rate plateaus. Without the time-walk correction, high-rate jitter becomes an issue well before the gradual drop of SNSPD efficiency. At the $\mu_H$ (22.9~mW) power, the singles rates $S_A, S_B$ average to 3.84 MHz, for which SNSPD efficiencies are about 78\% of nominal. 

<!-- % By about 16 MHz, SNSPD efficiency drops by 3dB.  -->


Using the data in @fig:figure_2nd_1 a, we model the JSI of our pair source as a product of pump envelope and phase matching condition functions

$$
|f(\omega_s, \omega_i)|^2 = |\psi_{\mathrm{ph}}\left(\omega_s, \omega_i\right)|^2 *|\psi_p\left(\omega_s, \omega_i\right)|^2,
$$

which depends on the wavelength (769.78 nm) and bandwidth (243 GHz FWHM) of up-converted light out of the SHG, measured with a spectrum analyzer. The path efficiencies from SPDC to detectors are also fitted based on integrations over the JSI that model the DWDM transmission passbands (see  <span class='html'>[the JSI analysis section](./section_06_modelling_details.md#joint-spectral-intensity-analysis)</span><span class='latex'>section \ref{joint-spectral-intensity-analysis}</span> for details). 

We calculate the Schmidt decomposition of the pair source JSI, taking into account the DWDM filters at Alice and Bob, and derive an average inverse Schmidt number $1/K$ of $0.87$. This value quantifies the spectral purity of the entangled photon source, and is theoretically equivalent to the visibility of a two-source HOM (Hong-Ou-Mandel) interferogram~[@mandel1995optical]. If 50 GHz ITU channels are used instead, the resulting filtered JSI better approximates a single mode, and the model predicts $1/K = 0.96$. 

